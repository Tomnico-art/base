

openssl： C语言写的加密工具

protobuf:序列化工具，针对跨平台传输

## 1. 总体架构

![image-20230118154857320](C:\Users\pengyang\AppData\Roaming\Typora\typora-user-images\image-20230118154857320.png)

主要实现功能：对网络通信数据进行加密解密的模块

- 网络通信
  - 数据传输 -> 保证数据的安全性

### 1. 基础组件

- 数据序列化
  - 组件：google protobuf
  - 解决跨平台数据传输问题
    - 字节序
    - 计算机位数
      - 32位
      - 64位
    - 字节序对齐
  - 序列化 -> 编码
    - 将原始数据按照某种格式进行封装 -> 特殊字符串
    - 将字符串发送给对方
  - 反序列化
    - 接收序列化的特殊字符串 -> 解析 -> 原始数据
    - 安装业务需求处理原始数据
- 套接字通信
  - tcp
  - 线程池 -> 服务端使用
  - 连接池 -> 客户端使用
- 共享内存操作
  - 进程间通信方式
  - 效率最高
- 数据库操作
  - 使用oracle
  - 使用oracle官方提供的c++接口 OCI

### 2.秘钥协商服务器 && 客户端

- 客户端的两种实现模式
  - 桌面程序 -> qt
  - 终端交互 -> linux终端

## 2.数据的加密和解密

### 2.1 加密三要素

![image-20230118200238351](C:\Users\pengyang\AppData\Roaming\Typora\typora-user-images\image-20230118200238351.png)

- 加密三要素
  - 明文/密文
    - 明文 -> 原始数据
    - 密文 -> 加密之后的数据
  - 秘钥 -> 定长的字符串
    - 对称加密 -> 自己生成
    - 非对称加密 -> 有对应的算法可以直接生成
  - 算法
    - 加密算法
    - 解密算法
  - 举例：
  - ![image-20230118201329274](C:\Users\pengyang\AppData\Roaming\Typora\typora-user-images\image-20230118201329274.png)

### 2.2 加密方式

- 对称加密
  - 秘钥比较短
  - 秘钥只有一个
    - 加密和解密使用的秘钥是相同的
  - 加密效率高
  - 加密强度相对较低（相对于非对称加密）
  - 秘钥分发困难 -> 因为秘钥要保密不能泄漏
    - **秘钥不能直接在网络环境中进行发送**
- 非对称加密
  - 秘钥比较长
  - 秘钥有两个，所有非对称加密算法都有生成密钥对的函数
    - 公钥 -> 可以公开
    - 私钥 -> 不能公开
  - 加密解密使用的秘钥不同
    - 如果使用公钥加密，`必须使用私钥解密`
    - 如果使用私钥加密，`必须使用公钥解密`
  - 效率低
  - 加密强度相对较高（相对于对称加密）
  - 秘钥可以直接分发 ->分发的公钥
  - 

## 3.常用加密算法

### 3.1 对称加密

- DES/3DES
- AES

### 3.2 对称加密

- RSA（数字签名和秘钥交换）

- ECC（椭圆曲线加密算法-数字签名）

  

  **秘钥交换的过程**

  ```bash
  //假设通信的双方为:客户端C。服务器端S
  为什么要交换?
  	1．非对称加密秘钥分发方便，但是效率低->改进:需要使用对称加密
  	2．使用对称加密->秘钥分发困难->改进:使用非对称加密进行秘钥分发
  		-分发是对称加密的秘钥，本质就是一个字符串
  //秘钥交换的过程:
  	1．在服务器端生成一个非对称加密的密钥对:公钥，私钥
  	2．服务器将公钥发送给客户端，客户端有了公钥
  	3．在客户端生成一个随机字符串->这就是对称加密需要使用的秘钥
  	4．在客户端使用公钥对生成的对称加密的必钥进行加密->密文
  	5．将加密的密文发送给服务器
  	6．服务器端使用私钥解密->对称加密的秘钥
  	7．双方使用同一秘钥进行对称加密通信
  
  ```

  

### 3.3 hash算法(单向散列函数)

特点:

- 不管原始数据有多长,通过哈希算法进行计算,得到的结果的长度是固定的

  - 是一个二进制的字符串

- 只要是原始数据不一样,得到的结果就不一样

  - 原始数据差—丢丢,得到的结果也是完全不同的。有很强的抗碰撞性
    - 碰撞:原始数据不同,但是通过同样的哈希算法进行计算能得到相同的结果。
    - 推导的结论:
      数据不同得到的结果就不同

  应用场景:

  - 数据校验
  - 登录验证
  - 秒传

- 不可逆

  - 得到的结果不能推导出原始数据



常用的hash算法以及散列长度

- MD4/MD5
  - 散列值长度: 16字节
  - 抗碰撞性已经被破解·
- SHA-1
  - 散列值长度:20字节。
  - 抗碰撞性已经被破解
- SHA-2
  - sha224
    ·散列值长度: 224bit / 8= 28byte
  - sha256
    ·散列值长度: 256bit / 8= 32byte
  - sha384
    ·散列值长度:384bit / 8= 48byte
  - sha512
    ·散列值长度:512bit / 8 = 64byte. 
- SHA3-224/SHA3-256/SHA3-384/SHA3-512

## 5.消息认证码->HMAC

作用:

- 在通信的时候,校验通信的数据有没有被篡改(完整性)。
- 没有加密的功能

使用:

- 消息认证码的本质是—个散列值
- **`(原始数据＋秘钥)*哈希函数=消息认证码。`**
  - 最关键的数据:秘钥

## 4.安装OpenSSL

### 4.1 openssl介绍

OpenSSL是一个安全**套接字层**密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及S$L协议，并提供丰富的应用程序供测试或其它目的使用。

SSL是Secure Sockets Layer (安全套接层协议）的缩写，可以在Internet上提供秘密性传输。Netscape公司在推出第一个Web浏览器的同时，提出了SSL协议标准。其目标是保证两个应用间通信的保密性和可靠性,可在服务器端和用户端同时实现支持。已经成为Internet上保密通讯的工业标准。